include ucpp/ucpp-settings

SCRIPT_INSTALL_DIR=$(PWD)/ucpp

wpilib: build-wpilib
	mkdir -p gccdist/WindRiver/vxworks-6.3/target/lib
	cp gccdist/WindRiver/vxworks-6.3/target/h/WPILib/PPC603gnu/WPILib/Debug/WPILib.a gccdist/WindRiver/vxworks-6.3/target/lib

build-wpilib: gccdist/WindRiver/vxworks-6.3/target/h/WPILib
	cd gccdist/WindRiver/vxworks-6.3/target/h/WPILib && $(SCRIPT_INSTALL_DIR)/ucpp-init && $(SCRIPT_INSTALL_DIR)/ucpp-configure wpipy && cd PPC603gnu && exec $(MAKE) -f Makefile_linux -j2

#clean:
#	\todo: add "clean" target

gccdist: gccdist.zip
	unzip -oDDqq gccdist.zip -d .
	mkdir -p gccdist/WindRiver/license
	cp gccdist/supp/zwrsLicense.lic gccdist/WindRiver/license/zwrsLicense.lic


gccdist.zip:
	wget ftp://ftp.ni.com/pub/devzone/tut/updated_vxworks63gccdist.zip -O gccdist.zip

gccdist/WindRiver/WPILib/WPILibC++Source20110106rev2242.zip: gccdist
	mkdir -p gccdist/WindRiver/WPILib
	wget http://team3021.com/files/programming/WPILibC++Source20110106rev2242.zip -O gccdist/WindRiver/WPILib/WPILibC++Source20110106rev2242.zip 

gccdist/WindRiver/vxworks-6.3/target/h/WPILib: gccdist/WindRiver/WPILib/WPILibC++Source20110106rev2242.zip
	unzip -oDDqq gccdist/WindRiver/WPILib/WPILibC++Source20110106rev2242.zip -d gccdist/WindRiver/vxworks-6.3/target/h || [ -d gccdist/WindRiver/WPILib ]